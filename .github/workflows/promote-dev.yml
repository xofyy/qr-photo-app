name: Promote Dev to Staging

on:
  push:
    branches:
      - dev

jobs:
  open-pr:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    steps:
      - name: Ensure PR from dev to staging exists
        uses: actions/github-script@v7
        with:
          script: |
            const { owner, repo } = context.repo;
            const head = `${owner}:dev`;
            const base = 'staging';
            const { data: pulls } = await github.rest.pulls.list({ owner, repo, head, base, state: 'open' });
            if (pulls.length === 0) {
              await github.rest.pulls.create({
                owner,
                repo,
                head: 'dev',
                base,
                title: `Promote dev to staging (${context.sha.substring(0, 7)})`,
                body: 'Auto-generated promotion PR. Please review and approve to promote changes from dev to staging.'
              });
            }
