name: Promote Staging to prod

on:
  push:
    branches:
      - staging

jobs:
  open-pr:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    steps:
      - name: Ensure PR from staging to prod exists
        uses: actions/github-script@v7
        with:
          script: |
            const {owner, repo} = context.repo;
            const head = ${owner}:staging;
            const base = 'prod';
            const existing = await github.rest.pulls.list({ owner, repo, head, base, state: 'open' });
            if (existing.data.length === 0) {
              await github.rest.pulls.create({
                owner,
                repo,
                head: 'staging',
                base,
                title: Promote staging to prod (),
                body: 'Auto-generated promotion PR. Approve to promote changes from staging to prod.'
              });
            }
